<th:block th:replace="~{layout/main-layout :: main_layout(~{::#change-password-content})}">
    <div id="change-password-content" class="max-w-5xl mx-auto px-4 py-8">

        <div class="text-[10px] font-black uppercase tracking-[0.2em] mb-8 text-slate-400 flex items-center gap-2">
            <a th:href="@{/}" class="hover:text-indigo-600 transition-colors">Trung tâm điều khiển</a>
            <i class="fa-solid fa-chevron-right text-[8px]"></i>
            <a th:href="@{/profile}" class="hover:text-indigo-600 transition-colors">Hồ sơ người dùng</a>
            <i class="fa-solid fa-chevron-right text-[8px]"></i>
            <span class="text-slate-800 font-black">Cấu hình mật khẩu</span>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2">
                <div class="card bg-white shadow-[0_20px_50px_rgba(0,0,0,0.04)] border border-slate-100 rounded-3xl overflow-hidden">
                    <div class="card-body p-8 md:p-12">
                        <div class="flex items-center gap-3 mb-10">
                            <div class="w-1.5 h-8 bg-indigo-600 rounded-full"></div>
                            <h2 class="text-2xl font-black text-slate-800 tracking-tight uppercase">Thiết lập mật khẩu mới</h2>
                        </div>

                        <form th:action="@{/security/change-password}" th:object="${passwordData}" method="POST" class="space-y-6">

                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="text-[11px] font-black uppercase tracking-widest text-slate-500">Xác thực mật khẩu hiện tại</span>
                                </label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center text-slate-400 group-focus-within:text-indigo-500 transition-colors">
                                        <i class="fa-solid fa-key"></i>
                                    </div>
                                    <input type="password" th:field="*{oldPassword}"
                                           class="input input-bordered w-full pl-11 h-14 bg-slate-50 border-slate-200 focus:bg-white focus:border-indigo-500 font-medium transition-all"
                                           placeholder="••••••••" required />
                                </div>
                            </div>

                            <div class="divider opacity-50"></div>

                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="text-[11px] font-black uppercase tracking-widest text-slate-500">Mật khẩu bảo mật mới</span>
                                </label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center text-slate-400 group-focus-within:text-indigo-500 transition-colors">
                                        <i class="fa-solid fa-lock text-sm"></i>
                                    </div>
                                    <input type="password" id="new-password" th:field="*{newPassword}"
                                           class="input input-bordered w-full pl-11 h-14 bg-slate-50 border-slate-200 focus:bg-white focus:border-indigo-500 font-medium transition-all"
                                           placeholder="••••••••" required />
                                </div>
                                <div class="mt-3 flex items-center gap-2">
                                    <progress class="progress progress-ghost flex-1 h-1.5 bg-slate-100" value="0" max="100" id="strength-bar"></progress>
                                    <span id="strength-text" class="text-[9px] font-black uppercase tracking-widest text-slate-400">Weak</span>
                                </div>
                            </div>

                            <div class="form-control w-full">
                                <label class="label">
                                    <span class="text-[11px] font-black uppercase tracking-widest text-slate-500">Tái xác thực mật khẩu</span>
                                </label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center text-slate-400 group-focus-within:text-indigo-500 transition-colors">
                                        <i class="fa-solid fa-shield-check"></i>
                                    </div>
                                    <input type="password" th:field="*{confirmPassword}"
                                           class="input input-bordered w-full pl-11 h-14 bg-slate-50 border-slate-200 focus:bg-white focus:border-indigo-500 font-medium transition-all"
                                           placeholder="••••••••" required />
                                </div>
                            </div>

                            <div class="card-actions justify-end mt-10 gap-4">
                                <a th:href="@{/profile}" class="btn btn-ghost text-slate-400 font-bold uppercase text-[10px] tracking-widest">Hủy bỏ</a>
                                <button type="submit" class="btn btn-primary bg-indigo-600 border-none px-10 h-14 text-sm font-black uppercase tracking-widest shadow-xl shadow-indigo-100 hover:bg-indigo-700 active:scale-95 transition-all">
                                    Cập nhật mật khẩu
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-1">
                <div class="card bg-slate-900 text-white shadow-2xl rounded-3xl overflow-hidden border border-slate-800">
                    <div class="absolute inset-0 opacity-10 pointer-events-none" style="background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.2) 1px, transparent 0); background-size: 16px 16px;"></div>

                    <div class="card-body p-8 relative z-10">
                        <div class="flex items-center gap-2 mb-8 p-3 bg-white/5 rounded-xl border border-white/10">
                            <i class="fa-solid fa-shield-halved text-indigo-400"></i>
                            <h3 class="text-[11px] font-black uppercase tracking-widest">Sentinel Security Policy</h3>
                        </div>

                        <ul class="space-y-4">
                            <li id="rule-length" class="flex items-center gap-3 text-slate-400 transition-all duration-300">
                                <span class="icon-status flex-shrink-0 w-6 h-6 rounded-lg bg-white/5 flex items-center justify-center border border-white/10">
                                    <i class="fa-solid fa-circle text-[6px] opacity-30"></i>
                                </span>
                                <span class="text-xs font-bold uppercase tracking-tight">Tối thiểu 8 ký tự</span>
                            </li>
                            <li id="rule-upper" class="flex items-center gap-3 text-slate-400 transition-all duration-300">
                                <span class="icon-status flex-shrink-0 w-6 h-6 rounded-lg bg-white/5 flex items-center justify-center border border-white/10">
                                    <i class="fa-solid fa-circle text-[6px] opacity-30"></i>
                                </span>
                                <span class="text-xs font-bold uppercase tracking-tight">Chữ cái viết hoa (A-Z)</span>
                            </li>
                            <li id="rule-number" class="flex items-center gap-3 text-slate-400 transition-all duration-300">
                                <span class="icon-status flex-shrink-0 w-6 h-6 rounded-lg bg-white/5 flex items-center justify-center border border-white/10">
                                    <i class="fa-solid fa-circle text-[6px] opacity-30"></i>
                                </span>
                                <span class="text-xs font-bold uppercase tracking-tight">Chữ số (0-9)</span>
                            </li>
                            <li id="rule-special" class="flex items-center gap-3 text-slate-400 transition-all duration-300">
                                <span class="icon-status flex-shrink-0 w-6 h-6 rounded-lg bg-white/5 flex items-center justify-center border border-white/10">
                                    <i class="fa-solid fa-circle text-[6px] opacity-30"></i>
                                </span>
                                <span class="text-xs font-bold uppercase tracking-tight">Ký tự đặc biệt (!@#)</span>
                            </li>
                        </ul>

                        <div class="mt-12 p-4 bg-indigo-500/10 rounded-2xl border border-indigo-500/20">
                            <div class="flex items-center gap-2 mb-2 text-indigo-300">
                                <i class="fa-solid fa-triangle-exclamation text-xs"></i>
                                <span class="text-[10px] font-black uppercase tracking-widest">Lưu ý bảo mật</span>
                            </div>
                            <p class="text-[10px] text-slate-400 leading-relaxed font-medium">
                                Hệ thống sẽ tự động đăng xuất tất cả thiết bị khác sau khi bạn cập nhật mật khẩu mới thành công.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const pwdInput = document.getElementById('new-password');
                const strengthBar = document.getElementById('strength-bar');
                const strengthText = document.getElementById('strength-text');

                const rules = {
                    length:  { el: document.getElementById('rule-length'),  check: (val) => val.length >= 8 },
                    upper:   { el: document.getElementById('rule-upper'),   check: (val) => /[A-Z]/.test(val) },
                    number:  { el: document.getElementById('rule-number'),  check: (val) => /[0-9]/.test(val) },
                    special: { el: document.getElementById('rule-special'), check: (val) => /[^A-Za-z0-9]/.test(val) }
                };

                const checkIcon = `<i class="fa-solid fa-check text-[10px] text-emerald-400"></i>`;
                const dotIcon = `<i class="fa-solid fa-circle text-[6px] opacity-30"></i>`;

                pwdInput.addEventListener('input', function() {
                    const val = this.value;
                    let score = 0;

                    Object.keys(rules).forEach(key => {
                        const rule = rules[key];
                        const isMatched = rule.check(val);
                        const iconContainer = rule.el.querySelector('.icon-status');

                        if (isMatched) {
                            rule.el.classList.remove('text-slate-400');
                            rule.el.classList.add('text-emerald-400');
                            if (iconContainer) {
                                iconContainer.innerHTML = checkIcon;
                                iconContainer.classList.add('border-emerald-500/50', 'bg-emerald-500/10');
                            }
                            score += 25;
                        } else {
                            rule.el.classList.add('text-slate-400');
                            rule.el.classList.remove('text-emerald-400');
                            if (iconContainer) {
                                iconContainer.innerHTML = dotIcon;
                                iconContainer.classList.remove('border-emerald-500/50', 'bg-emerald-500/10');
                            }
                        }
                    });

                    if (strengthBar) {
                        strengthBar.value = score;
                        strengthBar.className = 'progress flex-1 h-1.5 bg-slate-100 transition-all ';
                        if (score <= 25) {
                            strengthBar.classList.add('progress-error');
                            strengthText.innerText = 'Rủi ro';
                            strengthText.className = 'text-[9px] font-black uppercase tracking-widest text-rose-500';
                        } else if (score <= 75) {
                            strengthBar.classList.add('progress-warning');
                            strengthText.innerText = 'Trung bình';
                            strengthText.className = 'text-[9px] font-black uppercase tracking-widest text-amber-500';
                        } else {
                            strengthBar.classList.add('progress-success');
                            strengthText.innerText = 'An toàn';
                            strengthText.className = 'text-[9px] font-black uppercase tracking-widest text-emerald-500';
                        }
                    }
                });
            });
        </script>
    </div>
</th:block>